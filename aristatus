#!/bin/sh

usage() {
	echo 'usage: aristatus [-s]' >&2
	exit 1
}

while getopts :s opt; do
	case "$opt" in
	s)	cras_flag='-o' ;;
	?)	usage ;;
	esac
done

the_date=$(date +'%Y-%m-%d %H:%M %p')

audio_status=$(amixer sget Master | tail -n1 | \
               sed -E 's/.*\[(.*%)\].*\[(on|off)\].*/\1 \2/')

wifi_status=$(iwctl station wlan0 show | grep 'Connected network' | \
              sed -E 's/^.*Connected network[[:space:]]*//;
                      s/[[:space:]]*?$//')
! [ "$wifi_status" ] && wifi_status='--'

if ! cras_status=$(NO_COLOR=1 cras "${cras_flag:--O}" 2>/dev/null); then
	cras_status='--'
fi

echo "| $cras_status | wifi: $wifi_status | audio: $audio_status | $the_date"
